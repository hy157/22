<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Akıllı Çiftlik Oyunu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body {margin:0; padding:0;}
    body {
      min-height:100vh; min-width:100vw;
      background: url(8.png) center/cover no-repeat;
      font-family: 'Segoe UI', Arial, sans-serif;
      box-sizing: border-box;
    }
    #top-bar {
      display: flex; align-items: center;
      background:rgba(255,255,255,0.80); box-shadow:0 2px 10px #0001;
      padding:10px 15px; border-bottom:2px solid #e5e5e5;
      z-index:2; position:relative; gap:14px;
      justify-content: flex-start;
    }
    #top-bar span, #top-bar img.icon {
      display: flex; align-items:center; font-size:1.1em; font-weight:600;
      background: #fff7; border-radius:18px; padding:2px 13px 2px 6px;
      margin-right:3px;
      border: 1.3px solid #bbb7;
    }
    #top-bar img.icon { width:28px; height:28px; margin-right:2px; background:none; padding:0; border:none;}
    #main-content {display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:68vh;}
    #field-area {margin-top:32px; min-height:180px; display:flex; justify-content:center; gap:19px;}
    .field {
      position:relative;
      width:190px;
      height:140px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      margin: auto;
    }
    .field-img {
      width:180px;
      height:105px;
      border-radius:19px;
      display:block;
      object-fit: cover;
      background: #efe7dd;
      box-shadow:0 4px 20px #0002;
      border: 2px solid #a1865b;
    }
    .actions {
      position:absolute; left:0; right:0; bottom:20px;
      display:flex; justify-content:center; gap:18px; z-index:2;
    }
    .action-btn { width:38px; height:38px; cursor:pointer; opacity:0.96; transition:opacity .13s;}
    .action-btn:hover { opacity:1; transform:scale(1.05);}
    .timer {text-align:center; margin:7px 0 0 0; font-size:1.05em; min-height:22px; color:#444;}
    .timer img {width:18px; vertical-align:middle; margin-right:2px;}
    small {font-size:0.90em; color:#666;}
    /* ALT BAR */
    #bottom-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(255,255,255,0.95); box-shadow: 0 -1px 12px #0001;
      padding: 7px 0 5px 0; z-index:10;
      display:flex; justify-content:center; gap:28px; align-items:center;
    }
    #bottom-bar .bbtn {
      background:none; border:none; outline:none;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      cursor:pointer; padding:6px 14px; transition:background .15s, transform .13s;
      border-radius:14px;
      font-size:1em; font-weight:600; color:#296010;
    }
    #bottom-bar .bbtn:active { background:#d8f3e7; transform:scale(0.97);}
    #bottom-bar img { width:30px; height:30px; }
    #bottom-bar span { font-size:0.97em; margin-top:2px;}
    /* MODAL */
    .modal-bg {
      position:fixed; top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.24); display:none; justify-content:center; align-items:center; z-index:999;
    }
    .modal {
      background:#fff; border-radius:18px; box-shadow:0 8px 32px #0003; min-width:240px;
      max-width:95vw; padding:22px 22px 13px 22px; text-align:center; position:relative;
      animation:popin .18s;
    }
    .modal img {width:45px; margin-bottom:8px;}
    .closeBtn {
      position:absolute; top:6px; right:13px; background:none; border:none; font-size:1.2em; color:#234;
      cursor:pointer; font-weight:800;
    }
    .magaza-list { display: flex; flex-direction: column; gap: 19px; align-items:center;}
    .magaza-item {
      display: flex; align-items: center; gap:13px; padding:7px 0;
      border-bottom:1px solid #eee;
      width:100%; max-width:350px; justify-content:space-between;
    }
    .magaza-item:last-child { border-bottom: none; }
    .magaza-item img {width:34px;}
    .magaza-item button {
      background: #f8ffe8; border:1px solid #b9dfa8; color:#225f13;
      border-radius:9px; padding:5px 15px; font-weight:700; font-size:1em;
      cursor:pointer; transition:background .15s;
    }
    .magaza-item button:active {background:#d8f3e7;}
    .depo-list {margin-top:10px; display:flex; flex-direction:column; gap:7px;}
    .depo-item { display:flex; align-items:center; gap:12px; justify-content:space-between; border-bottom:1px solid #f3f3f3; padding:3px 0;}
    .depo-item:last-child {border-bottom:none;}
    .depo-item img {width:22px;}
    .depo-item button {
      background:#fff5d8; border:1px solid #f6e6ba; color:#805a17;
      border-radius:8px; font-size:0.99em; padding:2px 10px; cursor:pointer; font-weight:600;
    }
    .depo-item button:active {background:#e8f5d8;}
    .well-panel {
      margin-top:8px; background:#f8fff7; border-radius:10px; padding:11px; border:1px solid #cdf1ea; display:inline-block;
    }
    .well-panel img {vertical-align:middle;}
    .well-panel button {
      background:#e2fff8; border:1px solid #b9e1d8; color:#247a63;
      border-radius:9px; padding:5px 14px; margin-left:7px; font-size:0.99em; font-weight:600; cursor:pointer;
    }
    .well-panel button:active {background:#cdf5e8;}
    @keyframes popin {0%{transform:scale(.83); opacity:0;} 100%{transform:scale(1); opacity:1;}}
    @media (max-width:600px){
      #field-area { margin-top:12px; }
      .field { width:95vw; max-width:330px; }
      .field-img { width:100%; }
      .modal { padding:11px 2vw;}
      .magaza-item {max-width:97vw;}
    }
    body {padding-bottom:72px;}
  </style>
</head>
<body>
  <div id="top-bar">
    <span><img src="15.png" class="icon" alt="Para"> <b id="coin">100</b></span>
    <span><img src="14.png" class="icon" alt="Enerji"> <b id="energy">100</b></span>
    <span><img src="13.png" class="icon" alt="Elmas"> <b id="gem">100</b></span>
  </div>
  <div id="main-content">
    <div id="field-area"></div>
  </div>
  <div id="bottom-bar">
    <button class="bbtn" id="depoBtn"><img src="5.png"><span>Depo</span></button>
    <button class="bbtn" id="magazaBtn"><img src="6.png"><span>Mağaza</span></button>
    <button class="bbtn" id="gorevBtn"><img src="7.png"><span>Görevler</span></button>
    <button class="bbtn" id="ayarBtn"><img src="18.png"><span>Ayarlar</span></button>
  </div>
  <!-- MODAL -->
  <div id="modalbg" class="modal-bg">
    <div class="modal" id="modalBox">
      <button class="closeBtn" onclick="modalKapat()">×</button>
      <div id="modalContent"></div>
    </div>
  </div>
  <script>
    // --- OYUN DEĞİŞKENLERİ
    let durum = {
      coin: 100,
      energy: 100,
      gem: 100,
      depot: { }, // ürün/miktar
      tarlalar: [ { durum: "empty", time: 0, crop: null } ], // ilk başta 1 tarla
      suKuyusu: { aktif:false, su:0, last:Date.now() },
      degirmen: false,
      firin: false
    };
    // ÜRÜN VERİLERİ (süreler: zorluk, saniye)
    let urunler = [
      { ad:"Buğday", key:"bugday", sprite:"21.png", grow:30, fiyat:5 },
      { ad:"Mısır", key:"misir", sprite:"20.png", grow:45, fiyat:8 },
      { ad:"Domates", key:"domates", sprite:"12.png", grow:65, fiyat:14 }
    ];
    let unSprite = "12.png", ekmekSprite="9.png", suSprite="20.png";
    // --- ARAYÜZ
    function updateBar() {
      document.getElementById("coin").innerText = durum.coin;
      document.getElementById("energy").innerText = durum.energy;
      document.getElementById("gem").innerText = durum.gem;
    }
    // TARLA ÇİZ
    function renderFields() {
      let alan = document.getElementById("field-area");
      alan.innerHTML = "";
      durum.tarlalar.forEach((f, i)=>{
        let urun = f.crop!=null ? urunler.find(u=>u.key===f.crop) : null;
        let img = "1.png";
        if(f.durum==="growing") img = (f.time<(urun.grow/2)) ? "2.png" : "3.png";
        if(f.durum==="ready") img="4.png";
        alan.innerHTML += `
        <div class="field" id="field${i}">
          <img src="${img}" class="field-img" id="field-img${i}">
          <div class="actions" id="actions${i}">
            <img src="17.png" class="action-btn" id="seedBtn${i}" title="Tohum ek" style="${f.durum==='empty'?'':'display:none;'}">
            <img src="19.png" class="action-btn" id="harvestBtn${i}" title="Hasat et" style="${f.durum==='ready'?'':'display:none;'}">
          </div>
          <div class="timer" id="timer${i}">
            ${f.durum==="growing"?`<img src="${urun.sprite}"> <small>${urun.ad} <span>${urun.grow-f.time}s</span></small>`:""}
            ${f.durum==="ready"?`<img src="${urun.sprite}"> <small>Hazır!</small>`:""}
          </div>
        </div>`;
      });
      // Buton fonksiyonları ekle
      durum.tarlalar.forEach((f, i)=>{
        let urun = f.crop!=null ? urunler.find(u=>u.key===f.crop) : null;
        let ek = document.getElementById("seedBtn"+i);
        if(ek) ek.onclick = function() {
          if(durum.energy<1) return alert("Yeterli enerji yok!");
          durum.energy -= 1;
          durum.tarlalar[i] = { durum:"growing", time:0, crop:"bugday" }; // örnek: sadece buğday eklenebilir (geliştirilebilir)
          updateBar(); renderFields();
        };
        let hs = document.getElementById("harvestBtn"+i);
        if(hs) hs.onclick = function() {
          durum.depot[urun.ad] = (durum.depot[urun.ad]||0) + 1;
          durum.tarlalar[i] = { durum:"empty", time:0, crop:null };
          durum.coin += urun.fiyat; // direkt otomatik satma yoksa bu satırı kaldırabilirsin
          updateBar(); renderFields();
        };
      });
    }
    // ---- MODAL sistemi
    function modalGoster(html) {
      document.getElementById("modalContent").innerHTML = html;
      document.getElementById("modalbg").style.display="flex";
    }
    function modalKapat() {
      document.getElementById("modalbg").style.display="none";
    }
    // --- MAĞAZA
    document.getElementById("magazaBtn").onclick = function() {
      let magazaHTML = `
      <div class="magaza-list">
        <div class="magaza-item">
          <img src="1.png"><b>Tarla</b>
          <button onclick="satinal('tarla')">10 <img src='15.png' style='width:15px;vertical-align:middle'></button>
        </div>
        <div class="magaza-item">
          <img src="22.png"><b>Fırın</b>
          <button onclick="satinal('firin')">40 <img src='15.png' style='width:15px;vertical-align:middle'></button>
        </div>
        <div class="magaza-item">
          <img src="24.png"><b>Değirmen</b>
          <button onclick="satinal('degirmen')">30 <img src='15.png' style='width:15px;vertical-align:middle'></button>
        </div>
        <div class="magaza-item">
          <img src="23.png"><b>Su Kuyusu</b>
          <button onclick="satinal('sukuyusu')">20 <img src='15.png' style='width:15px;vertical-align:middle'></button>
        </div>
      </div>`;
      modalGoster("<h3>Mağaza</h3>" + magazaHTML);
    };
    // Satın alma
    window.satinal = function(ne) {
      let fiyat = { "tarla":10, "firin":40, "degirmen":30, "sukuyusu":20 }[ne];
      if(durum.coin < fiyat) { alert("Yeterli paran yok!"); return; }
      durum.coin -= fiyat;
      if(ne==="tarla") durum.tarlalar.push({ durum:"empty", time:0, crop:null });
      if(ne==="firin") durum.firin=true;
      if(ne==="degirmen") durum.degirmen=true;
      if(ne==="sukuyusu") durum.suKuyusu.aktif=true;
      updateBar(); renderFields(); modalKapat();
    }
    // --- DEPO (ÜRÜN SAT)
    document.getElementById("depoBtn").onclick = function() {
      let depoHTML = `<h3>Depo</h3><div class="depo-list">`;
      let dep = durum.depot;
      let satF = function(ad,fiyat){
        return `<button onclick="urunSat('${ad}',${fiyat})">Sat (${fiyat} <img src='15.png' style='width:14px;vertical-align:middle'>)</button>`;
      };
      let varMi = false;
      Object.keys(dep).forEach(ad=>{
        if(dep[ad]>0){
          varMi=true;
          let spr = (ad=="Buğday"?"21.png":ad=="Mısır"?"20.png":ad=="Domates"?"12.png":ad=="Un"?"12.png":ad=="Ekmek"?"9.png":ad=="Su"?"20.png":"");
          let fiyat = ad=="Buğday"?5:ad=="Mısır"?8:ad=="Domates"?14:ad=="Un"?18:ad=="Ekmek"?35:ad=="Su"?3:1;
          depoHTML += `<div class="depo-item"><img src="${spr}">${ad} <b>x${dep[ad]}</b> ${satF(ad,fiyat)}</div>`;
        }
      });
      if(!varMi) depoHTML += `<div style="opacity:.75; font-size:.98em;">Depo boş</div>`;
      depoHTML += "</div>";
      modalGoster(depoHTML);
    };
    // Satış
    window.urunSat = function(ad,fiyat){
      if(!durum.depot[ad]||durum.depot[ad]<1) return;
      durum.depot[ad]-=1;
      durum.coin+=fiyat;
      updateBar();
      document.getElementById("depoBtn").click();
    }
    // -- GÖREV VE AYARLAR SADECE BİLGİ
    document.getElementById("gorevBtn").onclick = ()=>modalGoster("<img src='7.png'><h3>Görevler</h3><div>Henüz görev bulunmamaktadır.</div>");
    document.getElementById("ayarBtn").onclick = ()=>modalGoster("<img src='18.png'><h3>Ayarlar</h3><div>Ayarlar yakında aktif olacak.</div>");
    // --- SU KUYUSU PANELİ
    function showWell(){
      let su = durum.suKuyusu.su;
      let buton = `<button ${su==0?"disabled":""} onclick="suTopla()">Su Topla</button>`;
      let info = `<div class='well-panel'><img src='23.png'> <b>Su Kuyusu</b> <br>
      <small>Biriken Su: <b>${su}/10</b> &nbsp; (30sn'de 1 su, maks 10 birikir)</small><br>${buton}</div>`;
      modalGoster(info);
    }
    window.suTopla = function(){
      let su = durum.suKuyusu.su;
      if(su>0){
        durum.depot["Su"] = (durum.depot["Su"]||0) + su;
        durum.suKuyusu.su = 0;
        showWell();
      }
    }
    // --- DEĞİRMEN & FIRIN PANELİ
    function showDegirmen(){
      let bugday = durum.depot["Buğday"]||0, un = durum.depot["Un"]||0;
      let buton = `<button ${(bugday<1||durum.energy<1)?"disabled":""} onclick="unUret()">Un Üret (1 <img src='21.png'> 1 <img src='14.png'>)</button>`;
      let info = `<div style='padding:7px;'><img src='24.png'> <b>Değirmen</b><br>
      <small>1 Buğday + 1 Enerji = 1 Un</small><br>${buton}<br>
      Depo: <img src='21.png'>${bugday} <img src='12.png'>${un}</div>`;
      modalGoster(info);
    }
    window.unUret = function(){
      if((durum.depot["Buğday"]||0)<1||durum.energy<1) return;
      durum.depot["Buğday"]-=1;
      durum.depot["Un"] = (durum.depot["Un"]||0)+1;
      durum.energy -= 1;
      showDegirmen(); updateBar();
    }
    function showFirin(){
      let un = durum.depot["Un"]||0, su = durum.depot["Su"]||0, ekmek = durum.depot["Ekmek"]||0;
      let buton = `<button ${(un<1||su<1||durum.energy<1)?"disabled":""} onclick="ekmekUret()">Ekmek Üret (1 <img src='12.png'> 1 <img src='20.png'> 1 <img src='14.png'>)</button>`;
      let info = `<div style='padding:7px;'><img src='22.png'> <b>Fırın</b><br>
      <small>1 Un + 1 Su + 1 Enerji = 1 Ekmek</small><br>${buton}<br>
      Depo: <img src='12.png'>${un} <img src='20.png'>${su} <img src='9.png'>${ekmek}</div>`;
      modalGoster(info);
    }
    window.ekmekUret = function(){
      if((durum.depot["Un"]||0)<1||(durum.depot["Su"]||0)<1||durum.energy<1) return;
      durum.depot["Un"]-=1; durum.depot["Su"]-=1;
      durum.depot["Ekmek"]=(durum.depot["Ekmek"]||0)+1;
      durum.energy -= 1;
      showFirin(); updateBar();
    }
    // --- OYUN SAATİ: Su kuyusu ve tarlalar
    setInterval(function(){
      // Su kuyusu işle
      if(durum.suKuyusu.aktif) {
        let now = Date.now();
        let delta = Math.floor((now - durum.suKuyusu.last)/1000);
        if(delta >= 30 && durum.suKuyusu.su < 10) {
          let ekle = Math.min(Math.floor(delta/30), 10-durum.suKuyusu.su);
          durum.suKuyusu.su += ekle;
          durum.suKuyusu.last = now - ((delta%30)*1000);
        }
      }
      // Tarlalar büyüt
      durum.tarlalar.forEach((f,i)=>{
        if(f.durum=="growing"){
          f.time+=1;
          let u = urunler.find(u=>u.key===f.crop);
          if(f.time>=u.grow) { f.durum="ready"; }
        }
      });
      renderFields();
    },1000);
    // --- Başlangıçta
    renderFields(); updateBar();
    // --- Su Kuyusu, Fırın, Değirmen aktifse panel açmak için alt bar'a ekle
    setInterval(function(){
      let alt = document.getElementById("bottom-bar");
      if(!document.getElementById("wellBtn") && durum.suKuyusu.aktif){
        let btn = document.createElement("button");
        btn.className = "bbtn"; btn.id = "wellBtn";
        btn.innerHTML = `<img src="23.png"><span>Su Kuyusu</span>`;
        btn.onclick = showWell;
        alt.insertBefore(btn, alt.children[1]);
      }
      if(!document.getElementById("degirmenBtn") && durum.degirmen){
        let btn = document.createElement("button");
        btn.className = "bbtn"; btn.id = "degirmenBtn";
        btn.innerHTML = `<img src="24.png"><span>Değirmen</span>`;
        btn.onclick = showDegirmen;
        alt.insertBefore(btn, alt.children[2]);
      }
      if(!document.getElementById("firinBtn") && durum.firin){
        let btn = document.createElement("button");
        btn.className = "bbtn"; btn.id = "firinBtn";
        btn.innerHTML = `<img src="22.png"><span>Fırın</span>`;
        btn.onclick = showFirin;
        alt.insertBefore(btn, alt.children[3]);
      }
    },700);
  </script>
</body>
</html>
